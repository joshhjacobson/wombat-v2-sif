# Get list of make targets
make -qp | awk -F':' '/^[a-zA-Z0-9][^$#\\\t=]*:([^=]|$)/ {split($1,A,/ /);for(i in A)print A[i]}' | grep ...

# Files updates:
chmod +x 3_sif/modify-timestamps.sh
bash 3_sif/modify-timestamps.sh

chmod +x 4_inversion/modify-timestamps.sh
bash 4_inversion/modify-timestamps.sh


# Supposedly these are the only needed sensitivity files (but could simply copy all sensitivities):
3_inversion/intermediates/sensitivities-base-oco2-hourly-part-1.fst
3_inversion/intermediates/sensitivities-base-obspack-hourly-assim-1-part-1.fst
3_inversion/intermediates/sensitivities-base-oco2-daily-part-1.fst
3_inversion/intermediates/sensitivities-base-obspack-daily-assim-1-part-1.fst
3_inversion/intermediates/sensitivities-base-oco2-hourly-part-1.fst
3_inversion/intermediates/sensitivities-r10-r15-rNZ-obspack-hourly-assim-1-part-1.fst
3_inversion/intermediates/sensitivities-r10-r15-rNZ-oco2-daily-part-1.fst
3_inversion/intermediates/sensitivities-r10-r15-rNZ-obspack-daily-assim-1-part-1.fst

rsync -azP $(find /data/wombat-v2-workflow/3_inversion/intermediates/sensitivities-* -not -regex '.*\(lauder\).*') 4_inversion/intermediates
rsync -azP /data/wombat-v2-workflow/3_inversion/intermediates/samples-LNLGIS.rds 4_inversion/intermediates

# Sync results with local machine
rsync -azP --exclude archive jj829@hpc.niasra.uow.edu.au:wombat-v2-sif/6_results_sif/figures/ "/Users/joshjacobson/OneDrive - University of Wollongong/Document_Prep/Papers/acp_JJ_MB_AZM_AS_NC/figures"

# Individual targets:

OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/observations-sif.fst
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sib4-hourly-sif-2016.nc

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sib4-monthly-sif-2x25.nc --dry-run

OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sib4-hourly-sif-assim-2x25-2016.nc
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/model-sif-assim.fst
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/oco2-hourly-sif.fst
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sib4-hourly-climatology-inventory-assim-2x25-2018.nc
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sib4-hourly-residual-assim-2x25-2018.nc
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 3_sif/intermediates/sensitivities-oco2-hourly-sif.fst --dry-run
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/observations.fst
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/H-SIF.mat.lz4 --dry-run
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/H-LNLG.mat.lz4 --dry-run
OMP_NUM_THREADS=32 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/H-IS.mat.lz4 --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/residual-1st-stage.fst --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/hyperparameter-estimates.fst --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/samples-LNLGIS.rds --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/samples-LNLGISSIF.rds --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-alpha.fst --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-observations-ALPHA0.fst --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHAV2-WSIF.rds --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHAV2-WOSIF.rds --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHA0-WSIF.rds --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHA0-WOSIF.rds --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHAV2-FREERESP-WSIF.rds --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-samples-ALPHAFREE-WOSIF.rds |& tee osse-samples-ALPHAFREE-WOSIF.txt

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/flux-aggregators.fst --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion/intermediates/osse-flux-aggregates-samples-ALPHA0-WOSIF.rds --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 4_inversion_targets --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 6_results_sif_targets --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 6_results_sif/figures/osse-true-fluxes.pdf
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 6_results_sif/figures/osse-metrics-table.tex --dry-run

OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 6_results_sif/intermediates/perturbations-augmented.fst --dry-run
OMP_NUM_THREADS=16 WOMBAT_LOG_LEVEL=trace make 6_results_sif/intermediates/six-year-average-LNLGIS.fst --dry-run